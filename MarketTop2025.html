<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Top 2025 - Price Prediction Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #16a34a 0%, #dc2626 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        h1 {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #16a34a 0%, #dc2626 100%);
            color: white;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .llm-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .llm-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: white;
            border: 2px solid #16a34a;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .llm-checkbox:hover {
            background: #f0fdf4;
            transform: translateY(-2px);
        }

        .llm-checkbox input[type="checkbox"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .llm-checkbox label {
            cursor: pointer;
            font-weight: 500;
            color: #333;
        }

        .outlier-control {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: white;
            border: 2px solid #16a34a;
            border-radius: 20px;
        }

        .outlier-control input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .outlier-control label {
            font-weight: 600;
            color: #16a34a;
            cursor: pointer;
        }

        .tabs {
            display: flex;
            overflow-x: auto;
            background: #f8f9fa;
            border-bottom: 3px solid #16a34a;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            background: #e9ecef;
            border: none;
            border-right: 1px solid #dee2e6;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab:hover {
            background: #dee2e6;
        }

        .tab.active {
            background: white;
            color: #16a34a;
            border-bottom: 3px solid #16a34a;
            margin-bottom: -3px;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        thead {
            background: linear-gradient(135deg, #16a34a 0%, #dc2626 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        tbody tr {
            transition: all 0.2s ease;
        }

        tbody tr:hover {
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background-color: #f8f9fa !important;
        }

        .sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 20px;
        }

        .sortable:hover {
            background: rgba(255,255,255,0.1);
        }

        .sortable::after {
            content: '⇅';
            position: absolute;
            right: 5px;
            opacity: 0.5;
        }

        .sortable.asc::after {
            content: '↑';
            opacity: 1;
        }

        .sortable.desc::after {
            content: '↓';
            opacity: 1;
        }

        .llm-count {
            display: inline-block;
            background: #16a34a;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        /* Modal/Popup Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.2s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            font-size: 1.5em;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #16a34a;
        }

        .modal-body {
            color: #333;
            line-height: 1.8;
            font-size: 1em;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            background: none;
            border: none;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            color: #dc2626;
            transform: scale(1.2);
        }

        .show-reasoning-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #16a34a 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(22, 163, 74, 0.3);
        }

        .show-reasoning-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(22, 163, 74, 0.5);
        }

        .price-value {
            font-weight: 600;
            font-size: 1.1em;
            color: #16a34a;
        }

        .date-value {
            font-weight: 500;
            color: #475569;
        }

        .calculation-breakdown {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .calculation-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-left: 4px solid #16a34a;
            border-radius: 4px;
        }

        .calculation-summary {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #16a34a 0%, #dc2626 100%);
            color: white;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Market Top 2025 - Price Prediction Analysis</h1>

        <div class="controls">
            <div class="outlier-control">
                <input type="checkbox" id="removeOutliers" checked>
                <label for="removeOutliers">Remove Outliers</label>
            </div>

            <div class="llm-checkboxes" id="llmCheckboxes"></div>
        </div>

        <div class="tabs" id="tabs"></div>

        <div id="tabContents"></div>
    </div>

    <!-- Modal for popups -->
    <div id="popupModal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div class="modal-header" id="modalHeader"></div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        const csvData = {
            'ChatGPT 1': [],
            'ChatGPT 2': [],
            'Claude 1': [],
            'Claude 2': [],
            'Gemini 1': [],
            'Gemini 2': [],
            'Grok 1': [],
            'Grok 2': [],
            'Kimi 1': [],
            'Kimi 2': []
        };

        const llmFiles = {
            'ChatGPT 1': 'MarketTop2025/ChatGPT 1.csv',
            'ChatGPT 2': 'MarketTop2025/ChatGPT 2.csv',
            'Claude 1': 'MarketTop2025/Claude 1.csv',
            'Claude 2': 'MarketTop2025/Claude 2.csv',
            'Gemini 1': 'MarketTop2025/Gemini 1.csv',
            'Gemini 2': 'MarketTop2025/Gemini 2.csv',
            'Grok 1': 'MarketTop2025/Grok 1.csv',
            'Grok 2': 'MarketTop2025/Grok 2.csv',
            'Kimi 1': 'MarketTop2025/Kimi 1.csv',
            'Kimi 2': 'MarketTop2025/Kimi 2.csv'
        };

        let selectedLLMs = new Set(Object.keys(llmFiles));
        let removeOutliers = true;
        let updateTimeout;
        let sortDirection = {}; // Track sort direction per tab
        let currentCombinedData = []; // Store current combined data for popups
        let currentLLMData = {}; // Store current LLM data for popups

        // Show modal with content
        function showModal(header, body) {
            document.getElementById('modalHeader').innerHTML = header;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('popupModal').classList.add('show');
        }

        // Close modal
        function closeModal(event) {
            if (!event || event.target === document.getElementById('popupModal')) {
                document.getElementById('popupModal').classList.remove('show');
            }
        }

        // Show reasoning popup
        function showReasoning(assetName, reasoning) {
            showModal(`Reasoning for: ${assetName}`, `<div style="line-height: 1.8;">${reasoning}</div>`);
        }

        // Format price with $ and commas
        function formatPrice(price) {
            return '$' + price.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Convert YYYY-MM to numeric value for averaging (2025-10 -> 2025.833...)
        function dateToNumeric(dateStr) {
            if (!dateStr || dateStr.trim() === '') return 0;
            const parts = dateStr.split('-');
            if (parts.length !== 2) return 0;
            const year = parseInt(parts[0]);
            const month = parseInt(parts[1]);
            return year + (month - 1) / 12;
        }

        // Convert numeric value back to YYYY-MM (2025.833... -> 2025-10)
        function numericToDate(numericDate) {
            const year = Math.floor(numericDate);
            const monthFraction = numericDate - year;
            const month = Math.round(monthFraction * 12) + 1;
            return `${year}-${String(month).padStart(2, '0')}`;
        }

        // Format date nicely (e.g., "2025-10" -> "Oct 2025")
        function formatDate(dateStr) {
            if (!dateStr || dateStr.trim() === '') return 'N/A';

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                          'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            // Check if it's in YYYY-MM format
            const parts = dateStr.split('-');
            if (parts.length === 2) {
                const year = parts[0];
                const month = parseInt(parts[1]) - 1;
                if (month >= 0 && month < 12) {
                    return `${months[month]} ${year}`;
                }
            }

            // Try to parse as a date
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) {
                // If parsing fails, return original string
                return dateStr;
            }

            return `${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        // Show price calculation popup
        function showPriceCalculation(assetName, pricesWithLLM, rawPrices, avgPrice) {
            let breakdown = '<div class="calculation-breakdown">';

            pricesWithLLM.forEach(({ llm, price }) => {
                breakdown += `<div class="calculation-item">${formatPrice(price)} (${llm})</div>`;
            });

            breakdown += '</div>';

            let calculation = '';
            if (removeOutliers && rawPrices.length >= 3) {
                const sorted = [...rawPrices].sort((a, b) => a - b);
                const lowest = sorted[0];
                const highest = sorted[sorted.length - 1];
                const used = sorted.slice(1, -1);

                calculation = `
                    <div class="calculation-summary">
                        Formula: (${used.map(p => formatPrice(p)).join(' + ')}) / ${used.length}<br>
                        <small style="opacity: 0.8;">Removed outliers: Lowest (${formatPrice(lowest)}) and Highest (${formatPrice(highest)})</small><br>
                        = <strong>${formatPrice(avgPrice)}</strong>
                    </div>
                `;
            } else {
                calculation = `
                    <div class="calculation-summary">
                        Formula: (${rawPrices.map(p => formatPrice(p)).join(' + ')}) / ${rawPrices.length}<br>
                        = <strong>${formatPrice(avgPrice)}</strong>
                    </div>
                `;
            }

            showModal(
                `Price Calculation for: ${assetName}`,
                breakdown + calculation
            );
        }

        // Show individual LLM prediction info
        function showIndividualPrediction(assetName, llmName, price, date, reasoning) {
            const content = `
                <div style="margin-bottom: 15px;">
                    <strong>LLM:</strong> ${llmName}<br>
                    <strong>Predicted Top Price:</strong> ${formatPrice(price)}<br>
                    <strong>Predicted Date:</strong> ${formatDate(date)}
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; line-height: 1.8;">
                    <strong>Reasoning:</strong><br>
                    ${reasoning}
                </div>
            `;
            showModal(`Prediction Details: ${assetName}`, content);
        }

        // Parse CSV
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const result = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                if (!line.trim()) continue;

                const parts = [];
                let current = '';
                let inQuotes = false;

                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        parts.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                parts.push(current.trim());

                if (parts.length >= 4) {
                    result.push({
                        name: parts[0].replace(/^"|"$/g, ''),
                        price: parseFloat(parts[1]),
                        date: parts[2].replace(/^"|"$/g, ''),
                        reasoning: parts[3].replace(/^"|"$/g, '')
                    });
                }
            }

            return result;
        }

        // Load CSV files
        async function loadAllCSVs() {
            for (const [llm, file] of Object.entries(llmFiles)) {
                try {
                    const response = await fetch(file);
                    const text = await response.text();
                    csvData[llm] = parseCSV(text);
                } catch (error) {
                    console.error(`Error loading ${llm}:`, error);
                }
            }
            initializeUI();
        }

        // Calculate average with outlier removal
        function calculateAverage(prices) {
            if (prices.length === 0) return 0;
            if (prices.length === 1) return prices[0];

            if (removeOutliers && prices.length >= 3) {
                const sorted = [...prices].sort((a, b) => a - b);
                sorted.shift();
                sorted.pop();
                return sorted.reduce((a, b) => a + b, 0) / sorted.length;
            }

            return prices.reduce((a, b) => a + b, 0) / prices.length;
        }

        // Calculate average date (convert to numeric, average, convert back)
        function calculateAverageDate(dates) {
            if (dates.length === 0) return 'N/A';
            if (dates.length === 1) return dates[0];

            const numericDates = dates.map(dateToNumeric).filter(d => d > 0);
            if (numericDates.length === 0) return 'N/A';

            let datesToAverage = numericDates;

            if (removeOutliers && numericDates.length >= 3) {
                const sorted = [...numericDates].sort((a, b) => a - b);
                sorted.shift();
                sorted.pop();
                datesToAverage = sorted;
            }

            const avgNumeric = datesToAverage.reduce((a, b) => a + b, 0) / datesToAverage.length;
            return numericToDate(avgNumeric);
        }

        // Get combined data
        function getCombinedData() {
            const assetsMap = new Map();

            for (const [llm, assets] of Object.entries(csvData)) {
                if (!selectedLLMs.has(llm)) continue;

                for (const asset of assets) {
                    if (!assetsMap.has(asset.name)) {
                        assetsMap.set(asset.name, {
                            name: asset.name,
                            prices: [],
                            pricesWithLLM: [],
                            dates: [],
                            reasonings: []
                        });
                    }

                    const entry = assetsMap.get(asset.name);
                    entry.prices.push(asset.price);
                    entry.pricesWithLLM.push({ llm, price: asset.price });
                    entry.dates.push(asset.date);
                    entry.reasonings.push(`<strong>${llm}:</strong> ${asset.reasoning}`);
                }
            }

            const combined = [];
            for (const [name, data] of assetsMap) {
                combined.push({
                    name,
                    avgPrice: calculateAverage(data.prices),
                    avgDate: calculateAverageDate(data.dates),
                    llmCount: data.prices.length,
                    reasonings: data.reasonings.join('<br><br>'),
                    pricesWithLLM: data.pricesWithLLM,
                    rawPrices: data.prices,
                    dates: data.dates
                });
            }

            return combined.sort((a, b) => b.avgPrice - a.avgPrice);
        }

        // Sort LLM data
        function sortLLMData(llm, direction) {
            const data = [...csvData[llm]];
            if (direction === 'desc') {
                return data.sort((a, b) => b.price - a.price);
            } else if (direction === 'asc') {
                return data.sort((a, b) => a.price - b.price);
            }
            return data;
        }

        // Create table for individual LLM
        function createLLMTable(llm) {
            const currentSort = sortDirection[llm] || 'desc';
            const data = sortLLMData(llm, currentSort);

            currentLLMData[llm] = data; // Store for popup access

            const sortClass = currentSort === 'desc' ? 'desc' : (currentSort === 'asc' ? 'asc' : '');

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th width="30%">Asset Name</th>
                            <th width="20%" class="sortable ${sortClass}" onclick="toggleSort('${llm}')">Predicted Top Price</th>
                            <th width="15%">Predicted Date</th>
                            <th width="20%">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach((asset, index) => {
                html += `
                    <tr>
                        <td>${asset.name}</td>
                        <td class="price-value">${formatPrice(asset.price)}</td>
                        <td class="date-value">${formatDate(asset.date)}</td>
                        <td>
                            <button class="show-reasoning-btn" onclick="showLLMReasoning('${llm}', ${index})">
                                Show Reasoning
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            return html;
        }

        // Show LLM table reasoning by index
        function showLLMReasoning(llm, index) {
            const asset = currentLLMData[llm]?.[index];
            if (asset) {
                showIndividualPrediction(asset.name, llm, asset.price, asset.date, asset.reasoning);
            }
        }

        // Sort combined data
        function sortCombinedData(data, direction) {
            if (direction === 'desc') {
                return data.sort((a, b) => b.avgPrice - a.avgPrice);
            } else if (direction === 'asc') {
                return data.sort((a, b) => a.avgPrice - b.avgPrice);
            }
            return data;
        }

        // Create combined table
        function createCombinedTable() {
            const currentSort = sortDirection['Combined'] || 'desc';
            const data = sortCombinedData(getCombinedData(), currentSort);
            currentCombinedData = data; // Store for popup access

            const sortClass = currentSort === 'desc' ? 'desc' : (currentSort === 'asc' ? 'asc' : '');

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th width="20%">Asset Name</th>
                            <th width="18%" class="sortable ${sortClass}" onclick="toggleSort('Combined')">Avg Predicted Price</th>
                            <th width="15%">Avg Predicted Date</th>
                            <th width="10%">LLM Count</th>
                            <th width="18%">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach((asset, index) => {
                html += `
                    <tr>
                        <td>${asset.name}</td>
                        <td class="price-value">
                            <span style="cursor: pointer;" onclick="showCombinedPrice(${index})">
                                ${formatPrice(asset.avgPrice)}
                            </span>
                        </td>
                        <td class="date-value">
                            <span style="cursor: pointer;" onclick="showCombinedDate(${index})">
                                ${formatDate(asset.avgDate)}
                            </span>
                        </td>
                        <td><span class="llm-count">${asset.llmCount} LLMs</span></td>
                        <td>
                            <button class="show-reasoning-btn" onclick="showCombinedReasoning(${index})">
                                Show Reasoning
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            return html;
        }

        // Show combined table reasoning by index
        function showCombinedReasoning(index) {
            const asset = currentCombinedData[index];
            if (asset) {
                showModal(`Reasoning for: ${asset.name}`, `<div style="line-height: 1.8;">${asset.reasonings}</div>`);
            }
        }

        // Show combined table price by index
        function showCombinedPrice(index) {
            const asset = currentCombinedData[index];
            if (asset) {
                showPriceCalculation(asset.name, asset.pricesWithLLM, asset.rawPrices, asset.avgPrice);
            }
        }

        // Show combined table date by index
        function showCombinedDate(index) {
            const asset = currentCombinedData[index];
            if (asset) {
                showDateCalculation(asset.name, asset.dates, asset.avgDate);
            }
        }

        // Show date calculation popup
        function showDateCalculation(assetName, dates, avgDate) {
            let breakdown = '<div class="calculation-breakdown">';

            dates.forEach((date, i) => {
                const llmName = Object.keys(llmFiles)[i % Object.keys(llmFiles).length];
                breakdown += `<div class="calculation-item">${formatDate(date)} (${dateToNumeric(date).toFixed(4)})</div>`;
            });

            breakdown += '</div>';

            let calculation = '';
            const numericDates = dates.map(dateToNumeric).filter(d => d > 0);

            if (removeOutliers && numericDates.length >= 3) {
                const sorted = [...numericDates].sort((a, b) => a - b);
                const lowest = sorted[0];
                const highest = sorted[sorted.length - 1];
                const used = sorted.slice(1, -1);

                calculation = `
                    <div class="calculation-summary">
                        Formula: (${used.map(d => d.toFixed(4)).join(' + ')}) / ${used.length}<br>
                        <small style="opacity: 0.8;">Removed outliers: Earliest (${numericToDate(lowest)} = ${lowest.toFixed(4)}) and Latest (${numericToDate(highest)} = ${highest.toFixed(4)})</small><br>
                        = <strong>${formatDate(avgDate)}</strong>
                    </div>
                `;
            } else {
                calculation = `
                    <div class="calculation-summary">
                        Formula: (${numericDates.map(d => d.toFixed(4)).join(' + ')}) / ${numericDates.length}<br>
                        = <strong>${formatDate(avgDate)}</strong>
                    </div>
                `;
            }

            showModal(
                `Date Calculation for: ${assetName}`,
                breakdown + calculation
            );
        }

        // Switch tab
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`content-${tabName}`).classList.add('active');
        }

        // Toggle sort direction
        function toggleSort(tabName) {
            const current = sortDirection[tabName] || 'desc';
            sortDirection[tabName] = current === 'desc' ? 'asc' : 'desc';

            // Update only the specific tab
            if (tabName === 'Combined') {
                const combinedContent = document.getElementById('content-Combined');
                if (combinedContent) {
                    combinedContent.innerHTML = createCombinedTable();
                }
            } else {
                const content = document.getElementById(`content-${tabName}`);
                if (content) {
                    content.innerHTML = createLLMTable(tabName);
                }
            }
        }

        // Update all tables
        function updateAllTables() {
            // Update combined table
            const combinedContent = document.getElementById('content-Combined');
            if (combinedContent) {
                combinedContent.innerHTML = createCombinedTable();
            }

            // Update individual LLM tables
            for (const llm of Object.keys(llmFiles)) {
                const content = document.getElementById(`content-${llm}`);
                if (content) {
                    content.innerHTML = createLLMTable(llm);
                }
            }
        }

        // Update combined table with delay
        function scheduleUpdate() {
            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(() => {
                updateAllTables();
            }, 500);
        }

        // Initialize UI
        function initializeUI() {
            // Create LLM checkboxes
            const checkboxContainer = document.getElementById('llmCheckboxes');
            for (const llm of Object.keys(llmFiles)) {
                const div = document.createElement('div');
                div.className = 'llm-checkbox';
                div.innerHTML = `
                    <input type="checkbox" id="llm-${llm}" checked>
                    <label for="llm-${llm}">${llm}</label>
                `;
                checkboxContainer.appendChild(div);

                div.querySelector('input').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        selectedLLMs.add(llm);
                    } else {
                        selectedLLMs.delete(llm);
                    }
                    scheduleUpdate();
                });
            }

            // Outlier checkbox
            document.getElementById('removeOutliers').addEventListener('change', (e) => {
                removeOutliers = e.target.checked;
                scheduleUpdate();
            });

            // Create tabs
            const tabsContainer = document.getElementById('tabs');
            const tabContents = document.getElementById('tabContents');

            // Combined tab first
            const combinedTab = document.createElement('button');
            combinedTab.className = 'tab active';
            combinedTab.textContent = 'Combined';
            combinedTab.dataset.tab = 'Combined';
            combinedTab.addEventListener('click', () => switchTab('Combined'));
            tabsContainer.appendChild(combinedTab);

            const combinedContent = document.createElement('div');
            combinedContent.id = 'content-Combined';
            combinedContent.className = 'tab-content active';
            combinedContent.innerHTML = createCombinedTable();
            tabContents.appendChild(combinedContent);

            // Individual LLM tabs
            for (const llm of Object.keys(llmFiles)) {
                const tab = document.createElement('button');
                tab.className = 'tab';
                tab.textContent = llm;
                tab.dataset.tab = llm;
                tab.addEventListener('click', () => switchTab(llm));
                tabsContainer.appendChild(tab);

                const content = document.createElement('div');
                content.id = `content-${llm}`;
                content.className = 'tab-content';
                content.innerHTML = createLLMTable(llm);
                tabContents.appendChild(content);
            }
        }

        // Load data on page load
        loadAllCSVs();
    </script>
</body>
</html>
